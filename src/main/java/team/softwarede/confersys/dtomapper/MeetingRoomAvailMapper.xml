<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="team.softwarede.confersys.dtomapper.MeetingRoomAvailMapper">
  <resultMap id="BaseResultMap" type="team.softwarede.confersys.dto.MeetingRoomAvail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 29 09:02:50 CST 2019.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="room_number" jdbcType="VARCHAR" property="roomNumber" />
    <result column="building" jdbcType="VARCHAR" property="building" />
    <result column="floor" jdbcType="INTEGER" property="floor" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 29 09:02:50 CST 2019.
    -->
    id, room_number, building, floor
  </sql>
  <select id="selectBookAvailList" resultMap="BaseResultMap">
  <!-- 根据开始时间、结束时间、设备列表、容量查询可选用的会议室列表 -->
	select mtroom_id from(
	(select equipment_type_id,meeting_room_id
	from equipment 
	where meeting_room_id in
	    (
	        select mtroom_id 
	        from meeting_room_schedule INNER JOIN meeting
	        on meeting_room.meeting_id = meeting.id
	        where meeting.apply_status_id="succeed" and 
	                    (UNIX_TIMESTAMP(end_time) &gt; UNIX_TIMESTAMP(${beginTime}) or
	                     UNIX_TIMESTAMP(begin_time) &lt; UNIX_TIMESTAMP(${endTime}))
	     )INNER JOIN(
	                select mtroom_id
	                from meeting_room
	                where capacity &lt;= ${capacity}
	     )as t1
	)as t2
	RIGHT JOIN
	(
	    (<foreach collection="list" index="index" item="item" open="("
	    separator="," close=")">
	    #{item}
	    </foreach>
	    ) JOIN t1
	)as t3
	)USING equipment_type_id
	where t2.equipment_type_id is NULL
	GROUP BY mtroom_id
	having count(mtroom_id)=0

  </select>

</mapper>